<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>00_Introduction - sds-3.x/ScaDaMaLe</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../scroll-mdbook-outputs.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../contents/student-project-22_group-SwapWithDDP/00_Introduction.html" class="active">00_Introduction</a></li><li class="chapter-item expanded affix "><a href="../../contents/student-project-22_group-SwapWithDDP/01_SWAP_with_DDP.html">01_SWAP_with_DDP</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">sds-3.x/ScaDaMaLe</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<p>ScaDaMaLe Course <a href="https://lamastex.github.io/scalable-data-science/sds/3/x/">site</a> and <a href="https://lamastex.github.io/ScaDaMaLe/index.html">book</a></p>
</div>
<div class="cell markdown">
<h1 id="swapwithddp"><a class="header" href="#swapwithddp">SWAP<em>With</em>DDP</a></h1>
<ul>
<li>
<p>Christos Matsoukas @ChrisMats</p>
</li>
<li>
<p>Emir Konuk @emirkonuk</p>
</li>
<li>
<p>Johan Fredin Haslum @cfredinh</p>
</li>
<li>
<p>Miquel Marti @miquelmarti</p>
</li>
</ul>
<p><a href="https://openreview.net/pdf?id=rygFWAEFwS">Stochastic Weight Averaging in Parallel (SWAP)</a> in <a href="https://pytorch.org/">PyTorch</a></p>
<p>Everything related to the project can be found in <a href="https://github.com/ChrisMats/SWAP_with_DDP">this repository</a>.</p>
<p><a href="https://youtu.be/O3ZxNvEx48Q">Video demonstration</a></p>
<h2 id="install-dependencies-etc"><a class="header" href="#install-dependencies-etc">Install dependencies etc.</a></h2>
<ul>
<li>Python 3.8+</li>
<li>Pytorch 1.7+</li>
</ul>
<h3 id="install-using-conda"><a class="header" href="#install-using-conda">Install using conda</a></h3>
<ul>
<li>
<p>Using comands\ <code>conda create -n swap python=3.8 scikit-learn easydict matplotlib wandb tqdm -y</code>\ <code>conda install pytorch torchvision cudatoolkit=10.2 -c pytorch -y</code></p>
</li>
<li>
<p>Using the .yml file\ <code>conda env create -f environment.yml</code></p>
</li>
</ul>
<h2 id="docker-setup"><a class="header" href="#docker-setup">Docker setup</a></h2>
<ul>
<li>Note that the Dockerfile is provided for single machine, multiGPU usage. For multi-machine setups, refer to the SLURM section.</li>
<li>Dockerfile has its own comments. At the end of the file there are a few lines describing how to build/run the docker image. You can (and should) modify the port numbers depending on your setup.</li>
<li>Recommended folder setup is to have <em>/storage</em> in the host machine and <em>/storage</em> in the docker image. Clone <a href="https://github.com/ChrisMats/SWAP_with_DDP">this repository</a> to the <em>/storage</em> in the host machine, and work from there. You can change the WORKDIR (Line 107) in the Dockerfile if you desire a different folder setup.</li>
<li>By default, the image will start with a jupyter notebook running, accessible at port 8855. If you want to login to bash directly, comment/uncomment the respective lines (109 &amp; 111).</li>
<li>Remember to add your WANDB<em>API</em>KEY to the respective line in the Dockerfile.</li>
<li>You can change your image username (line 31). The default is swapuser.</li>
<li>If you want to directly clone the repo to the image, you can just add the link and uncomment the respective line (line 103). This is not recommended as you will most likely connect to git from the host for secure access.</li>
<li>If you need to set up rootless docker with nvidia GPU support, first install <a href="https://docs.docker.com/engine/security/rootless/">rootless docker</a>. Then, install <a href="https://github.com/NVIDIA/nvidia-docker">nvidia-docker</a>. After installation, remember to edit <em>/etc/nvidia-container-runtime/config.toml</em> to have <em>&quot;no-cgroups = true&quot;</em> before restarting the docker daemon.</li>
</ul>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<ul>
<li>All input options need to be modified in the <em>params.json</em> file.\ <code>cd your_path/SWAP_with_DDP</code>\ <code>python classification.py --params_path params.json</code></li>
<li>About the params, if you increase the num_workers and notice that it is slow, you should set it back to 0 or 1. This is a problem that occurs occasionally with pytorch DDP.</li>
</ul>
<h2 id="distributed-training-using-slurm"><a class="header" href="#distributed-training-using-slurm">Distributed training using SLURM</a></h2>
<ul>
<li>Before starting training, define necessary resources for each node in the <code>cluster_run.sbatch</code> file.</li>
<li>Train on multiple nodes on SLURM cluster using comand \ <code>cd your_path/SWAP_with_DDP</code>\ <code>sbatch cluster_run.sbatch your_conda_env data_location</code></li>
<li>(N-number of nodes)x(P-processes per node) are initiated each running <code>main.py</code></li>
<li>All comunications between processes are handled over TCP and a master process adress is set using <code>--dist_url</code></li>
<li>The code, conda environment and data location have to be available from all nodes with the same paths</li>
</ul>
<h3 id="results"><a class="header" href="#results">Results</a></h3>
<p>CIFAR10 - 8 GPUs - 512 per gpu - 150 epochs - Step 2 starts at step 1500 - without SWAP 94.3, with SWAP 95.7</p>
<p>Please refer to the <a href="https://github.com/ChrisMats/SWAP_with_DDP">project repository</a> for the images.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next" href="../../contents/student-project-22_group-SwapWithDDP/01_SWAP_with_DDP.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next" href="../../contents/student-project-22_group-SwapWithDDP/01_SWAP_with_DDP.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
